{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container">
  <h2>Choose Your Items</h2>

  <div class="row">
    <!-- Cart Summary -->
    <div class="col-md-4">
      <div class="card p-3">
        <h5>Your Cart</h5>
        <div id="cart-items">
          {% for item in cart_items %}
          <div class="d-flex justify-content-between align-items-center mb-2" data-item-id="{{ item.product.id }}">
            <div>
              <strong>{{ item.product.name }}</strong><br>
              ₹{{ item.product.price }} × {{ item.quantity }}
            </div>
            <div class="quantity-controls d-flex align-items-center gap-1" data-item-id="{{ item.product.id }}">
              <button class="btn btn-outline-secondary btn-sm btn-decrease">−</button>
              <span class="item-qty">{{ item.quantity }}</span>
              <button class="btn btn-outline-secondary btn-sm btn-increase">+</button>
            </div>
          </div>
          {% empty %}
          <p>No items in cart.</p>
          {% endfor %}
        </div>
        <hr>
        <p><strong>Subtotal:</strong> <span id="cart-subtotal">₹{{ subtotal }}</span></p>
        <a href="{% url 'products:magic_created' %}" class="btn btn-success">Next Step</a>
      </div>
    </div>

    <!-- Product Filters & Items -->
    <div class="col-md-8">
      <div class="text-center mb-4">
        <button class="btn btn-outline-dark filter-btn mx-1" data-filter="T-Shirts">T-Shirts</button>
        <button class="btn btn-outline-dark filter-btn mx-1" data-filter="Water Bottles"> Water Bottles</button>
        <button class="btn btn-outline-dark filter-btn mx-1" data-filter="Notebooks">Notebooks</button>
      </div>



      <div id="products" class="row">
        {% csrf_token %}

        <!-- Water Bottles -->
        <div class="col-md-4 mb-4 filter-item Water Bottles">
          <div class="card h-100">
            <img src="/media/products/Bottle1.jpeg" class="card-img-top" alt="Clear Bottle with White Cap">
            <div class="card-body text-center">
              <h5 class="card-title">Clear Bottle</h5>
              <form method="post" action="{% url 'products:add_to_cart' 1 %}">
                {% csrf_token %}
                <button type="submit" class="btn btn-dark">Add to Cart</button>
              </form>
            </div>
          </div>
        </div>

        <div class="col-md-4 mb-4 filter-item Water Bottles">
          <div class="card h-100">
            <img src="/media/products/Bottle2.jpeg" class="card-img-top" alt="Black Cap Water Bottle">
            <div class="card-body text-center">
              <h5 class="card-title">Bottle with Black Cap</h5>
              <form method="post" action="{% url 'products:add_to_cart' 2 %}">
                {% csrf_token %}
                <button type="submit" class="btn btn-dark">Add to Cart</button>
              </form>
            </div>
          </div>
        </div>

        <div class="col-md-4 mb-4 filter-item Water Bottles">
          <div class="card h-100">
            <img src="/media/products/Bottle3.jpeg" class="card-img-top" alt="Square Water Bottle">
            <div class="card-body text-center">
              <h5 class="card-title">Square Bottle</h5>
              <form method="post" action="{% url 'products:add_to_cart' 3 %}">
                {% csrf_token %}
                <button type="submit" class="btn btn-dark">Add to Cart</button>
              </form>
            </div>
          </div>
        </div>

        <div class="col-md-4 mb-4 filter-item Water Bottles">
          <div class="card h-100">
            <img src="/media/products/Bottle4.jpeg" class="card-img-top" alt="Slim Bottle with Handle">
            <div class="card-body text-center">
              <h5 class="card-title">Slim Handle Bottle</h5>
              <form method="post" action="{% url 'products:add_to_cart' 4 %}">
                {% csrf_token %}
                <button type="submit" class="btn btn-dark">Add to Cart</button>
              </form>
            </div>
          </div>
        </div>

        <div class="col-md-4 mb-4 filter-item Water Bottles">
          <div class="card h-100">
            <img src="/media/products/Bottle5.jpeg" class="card-img-top" alt="Frosted Bottle">
            <div class="card-body text-center">
              <h5 class="card-title">Frosted Bottle</h5>
              <form method="post" action="{% url 'products:add_to_cart' 5 %}">
                {% csrf_token %}
                <button type="submit" class="btn btn-dark">Add to Cart</button>
              </form>
            </div>
          </div>
        </div>

        <!-- Notebooks -->
        <div class="col-md-4 mb-4 filter-item Notebooks">
          <div class="card h-100">
            <img src="/media/products/Notebook1.jpeg" class="card-img-top" alt="Minimalist Notebook">
            <div class="card-body text-center">
              <h5 class="card-title">Minimalist Notebook</h5>
              <form method="post" action="{% url 'products:add_to_cart' 6 %}">
                {% csrf_token %}
                <button type="submit" class="btn btn-dark">Add to Cart</button>
              </form>
            </div>
          </div>
        </div>

        <div class="col-md-4 mb-4 filter-item Notebooks">
          <div class="card h-100">
            <img src="/media/products/Notebook2.jpeg" class="card-img-top" alt="Notebook2">
            <div class="card-body text-center">
              <h5 class="card-title">Notebook2</h5>
              <form method="post" action="{% url 'products:add_to_cart' 12 %}">
                {% csrf_token %}
                <button type="submit" class="btn btn-dark">Add to Cart</button>
              </form>
            </div>
          </div>
        </div>

        <div class="col-md-4 mb-4 filter-item Notebooks">
          <div class="card h-100">
            <img src="/media/products/Notebook3.jpeg" class="card-img-top" alt="Notebook3">
            <div class="card-body text-center">
              <h5 class="card-title">Notebook3</h5>
              <form method="post" action="{% url 'products:add_to_cart' 13 %}">
                {% csrf_token %}
                <button type="submit" class="btn btn-dark">Add to Cart</button>
              </form>
            </div>
          </div>
        </div>

        <!-- T-shirts -->
        <div class="col-md-4 mb-4 filter-item T-shirts">
          <div class="card h-100">
            <img src="/media/products/T-shirts1.jpeg" class="card-img-top" alt="Orange and White T-shirt">
            <div class="card-body text-center">
              <h5 class="card-title">Orange & White T-shirt</h5>
              <form method="post" action="{% url 'products:add_to_cart' 14 %}">
                {% csrf_token %}
                <button type="submit" class="btn btn-dark">Add to Cart</button>
              </form>
            </div>
          </div>
        </div>

        <div class="col-md-4 mb-4 filter-item T-shirts">
          <div class="card h-100">
            <img src="/media/products/T-shirt2.jpeg" class="card-img-top" alt="T-shirt">
            <div class="card-body text-center">
              <h5 class="card-title">T-shirt</h5>
              <form method="post" action="{% url 'products:add_to_cart' 11 %}">
                {% csrf_token %}
                <button type="submit" class="btn btn-dark">Add to Cart</button>
              </form>
            </div>
          </div>
        </div>

        <div class="col-md-4 mb-4 filter-item T-shirts">
          <div class="card h-100">
            <img src="/media/products/T-shirt3.jpeg" class="card-img-top" alt="Black T-shirt">
            <div class="card-body text-center">
              <h5 class="card-title">Black T-shirt</h5>
              <form method="post" action="{% url 'products:add_to_cart' 15 %}">
                {% csrf_token %}
                <button type="submit" class="btn btn-dark">Add to Cart</button>
              </form>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  const filterButtons = document.querySelectorAll('.filter-btn');
  const items = document.querySelectorAll('.filter-item');
  const cartItems = document.getElementById('cartItems');
  const cartCount = document.getElementById('cartCount');
  let cart = {};

  // Filter functionality
  filterButtons.forEach(button => {
    button.addEventListener('click', () => {
      const filter = button.getAttribute('data-filter');

      filterButtons.forEach(btn => btn.classList.remove('active'));
      button.classList.add('active');

      items.forEach(item => {
        item.style.display = (filter === 'all' || item.classList.contains(filter)) ? 'block' : 'none';
      });
    });
  });

  // Add to cart
  document.querySelectorAll('.add-to-cart').forEach(btn => {
    btn.addEventListener('click', () => {
      const itemName = btn.getAttribute('data-name');
      if (cart[itemName]) {
        cart[itemName]++;
      } else {
        cart[itemName] = 1;
      }
      updateCart();
    });
  });

  function updateCart() {
    cartItems.innerHTML = '';
    let total = 0;
    for (const item in cart) {
      const li = document.createElement('li');
      li.textContent = `${item} × ${cart[item]}`;
      cartItems.appendChild(li);
      total += cart[item];
    }
    cartCount.textContent = total;
  }
</script>
{% endblock %}